<h1 style = text-align:center> OS project1</h1>
<h3 style = text-align:right> B06902106 宋岩叡</h3>

## 1. Environment
- VirtualBox
- CPU: 2
- OS: Ubuntu 16.04
- Kernel Version: Linux-4.14.25

## 2. Design
### schedular
判斷輸入為何種policy後執行其policy
### FIFO
- 調高最先ready的process之priority
- 若有第二隻以上ready則保持原priority
### RR
- 使用queue 紀錄 ready processes
- 記錄時間，若時間=time quantum則從queue找下一支process
### SJF
- 使用heap 維護順序
- 跑完一支就者下一支，並從heap pop掉
### PSJF
- 使用heap 維護順序
- 每個unit time結束後確定下一支要跑的程式

### System call
- kernel/Makefile 加上
```
obj-y += print.o
obj-y += now_time.o
```
- include/linux/syscall_64.h 加上
```
asmlinkage void sys_print(char *s);
asmlinkage long sys_now_time(void);
```
- arch/x86/entry/syscalls/syscall_64.tbl 加上
```
334 common print sys_print
335 common now_time sys_now_time
```
### 3. Result
- FIFO_1.txt

以下是demo實際結果與理論結果的差異
| 實際順序 | 理論順序 | 實際開始時間 | 實際結束時間 | 理論開始時間 | 理論結束時間 |
| -------- | -------- | -------- |-|-|-|
| P1 | P1 | 0.00| 515.46434 |0.00 | 500.00|
| P2 | P2 | 515.931385| 1129.71798 |500.00|1000.00|
| P3 | P3 | 1140.17408|1716.97195|1000.00|1500.00|
| P4 | P4 | 1717.41593| 2240.5952 |1500.00|2000.00|
| P5 | P5 | 2240.92504| 2759.00325 |2000.00|2500.00|

由此表格可知，執行順序符合理論
實際執行時會比理論稍慢，process之間也會有間隔
- PSJF_2.txt

以下是demo實際結果與理論結果的差異
| 實際順序 | 理論順序 | 實際開始時間 | 實際結束時間 | 理論開始時間 | 理論結束時間 |
| -------- | -------- | -------- |-|-|-|
| P2 | P2 | 1084.6895| 2130.19498 |1000.00 | 2000.00|
| P1 | P1 | 0.00| 4397.62447 |0.00|4000.00|
| P4 | P4 | 5624.4306|7670.09293|5000.00|7000.00|
| P5 | P5 | 7715.15685|8856.07403|7000.00|8000.00|
| P3 | P3 | 4397.96499| 11838.42785 |4000.00|11000.00|
由此表格可知，執行順序符合理論
實際執行時會比理論稍慢，process之間也會有間隔

- RR_3.txt

以下是demo實際結果與理論結果的差異
| 實際順序 | 理論順序 | 實際開始時間 | 實際結束時間 | 理論開始時間 | 理論結束時間 |
| -------- | -------- | -------- |-|-|-|
| P3 | P3 | 4588.63996| 21838.15916 |4200.00 | 18200.00|
| P1 | P1 | 1200.00| 22886.85596 |1200.00|19700.00|
| P2 | P2 | 2927.38597|22886.85596|2700.00|20200.00|
| P6 | P6 | 8060.10186|23941.72627|8200.00|28200.00|
| P5 | P5 | 7924.20609|35935.45975|6700.00|30200.00|
| P4 | P4 | 6728.66606|37128.61827|6200.00|31200.00|
由此表格可知，執行順序符合理論
實際執行時大部分會比理論稍慢，process之間也會有間隔
但p6反而較早開始

- SJF_4.txt

以下是demo實際結果與理論結果的差異
| 實際順序 | 理論順序 | 實際開始時間 | 實際結束時間 | 理論開始時間 | 理論結束時間 |
| -------- | -------- | -------- |-|-|-|
| P1 | P1 | 0.00| 3338.13463 |0.00 | 3000.00|
| P2 | P2 |3338.61244|4429.42764|3000.00|4000.00|
| P3 | P3 |4429.87839|25524.35907|4000.00|8000.00|
| P5 | P5 |25525.11484|31757.65366|8000.00|9000.00|
| P4 | P4 |31758.59307|44530.61|9000.00|11000.00|

由此表格可知，執行順序符合理論
在p3以後突然慢很多

| testcase | timestemp abs error | timestemp relative error(%) | turnaround abs error | turnaround relative error(%) |
| -------- | ------------------- | --------------------------- | -------------------- | ---------------------------- |
| FIFO_1   | 293.23998491624263  | 16.739722268380627          | 51.461302294708545   | 10.292260458941709           |
| FIFO_2   | 8616.477073826736   | 10.123406236951131          | 1263.4130018120086   | 5.331992364023208            |
| FIFO_3   | 2699.694732465328   | 16.01078287892493           | 283.8321935786457    | 7.597681475978033            |
| FIFO_4   | 215.72336644058032  | 8.048380685262044           | 41.218799869955774   | 5.180496464404973            |
| FIFO_5   | 2098.928425573623   | 12.606289526116177          | 207.80212565541038   | 4.677870669281194            |
| RR_1     | 353.4155555320316   | 22.56097551352343           | 59.978756319740114   | 11.995751263948022           |
| RR_2     | 2296.247685033428   | 25.617474628984355          | 2245.052712765437    | 27.7933437670844             |
| RR_3     | 5163.361791656533   | 20.719779090345355          | 4087.0282701880737   | 20.769486586455732           |
| RR_4     | 12563.637134466653  | 78.42940443050564           | 11656.825662776462   | 74.16520159027601            |
| RR_5     | 3431.867094538068   | 30.01557415956125           | 2310.099359307265    | 20.499772775018796           |
| SJF_1    | 712.3614127932073   | 7.748397022470918           | 421.48560946277894   | 8.259415215373059            |
| SJF_2    | 2555.3321262219215  | 444.7911801892464           | 285.7417577397379    | 9.070437261132398            |
| SJF_3    | 3921.9948050971043  | 24.259387472622124         | 753.819004170608     | 15.90774722653193            |
| SJF_4    | 23126.479007649603  | 242.84131936162656          | 6705.598418725336    | 301.9139388217437            |
| SJF_5    | 15646.956043373399  | 566.22250746420635          | 2280.5712524646788   | 126.05232537547484           |
| PSJF_1   | 1153.5121993899209  | 9.376590049930708          | 911.7085469937118    | 8.205279478029112            |
| PSJF_2   | 942.931883522423    | 14.011680011118663          | 214.0346241237434    | 7.431668791948438            |
| PSJF_3   | 167.34434869019742  | 8.543717549198546          | 78.00255591650807    | 4.9778454099829825           |
| PSJF_4   | 903.3739870348145   | 11.225586529608413          | 393.2937805187619    | 9.184057685817446            |
| PSJF_5   | 2499.2346698472597  | 39.00817735025173           | 2191.601062867364    | 53.80914631754963            |

## 4. Conclusion
1. FIFO, RR, PSJ中特別大的誤差較少
2. 所有的順序皆符合
3. 幾乎所有的process都會比理論上晚開始，晚結束
4. process運作時間皆比理論上久
5. 其中誤差較大的可能是受到虛擬機中其他程式影響









